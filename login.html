<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register / Login | 24Dismil.com</title>
  <meta name="description"
    content="Register on 24Dismil.com to post and manage your property listings. India's most trusted real estate portal." />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/responsive.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    body {
      background: var(--bg);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .auth-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 80px 16px 40px;
    }

    .auth-card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      padding: 40px 36px;
      width: 100%;
      max-width: 440px;
    }

    .auth-logo {
      text-align: center;
      margin-bottom: 28px;
    }

    .auth-logo a {
      font-size: 22px;
      font-weight: 800;
      color: var(--primary);
      text-decoration: none;
    }

    .auth-tabs {
      display: flex;
      border-bottom: 2px solid var(--border);
      margin-bottom: 28px;
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 10px 0;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      color: var(--text-muted);
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: all 0.2s;
    }

    .auth-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
    }

    .auth-input-wrap {
      margin-bottom: 18px;
    }

    .auth-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--dark);
      display: block;
      margin-bottom: 6px;
    }

    .auth-input {
      width: 100%;
      padding: 11px 14px;
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .auth-input:focus {
      border-color: var(--primary);
    }

    .auth-btn {
      width: 100%;
      padding: 13px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 6px;
      transition: opacity 0.2s;
    }

    .auth-btn:hover {
      opacity: 0.9;
    }

    .auth-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .auth-err {
      background: #fee2e2;
      color: #b91c1c;
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      font-size: 13px;
      margin-bottom: 16px;
      display: none;
    }

    .auth-divider {
      text-align: center;
      color: var(--text-muted);
      font-size: 12px;
      margin: 16px 0;
    }

    .auth-switch {
      text-align: center;
      font-size: 13px;
      margin-top: 20px;
      color: var(--text-muted);
    }

    .auth-switch a {
      color: var(--primary);
      font-weight: 700;
      text-decoration: none;
    }

    .pass-wrap {
      position: relative;
    }

    .pass-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 18px;
      color: var(--text-muted);
    }

    .google-btn {
      width: 100%;
      padding: 11px;
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      background: #fff;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition:
        background 0.2s,
        box-shadow 0.2s;
      color: var(--dark);
      position: relative;
    }

    .google-btn:hover {
      background: #f9fafb;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .google-btn .soon-badge {
      position: absolute;
      right: 12px;
      font-size: 10px;
      background: #e5e7eb;
      color: #6b7280;
      padding: 1px 6px;
      border-radius: 99px;
      font-weight: 700;
    }
  </style>
  <link rel="icon" type="image/svg+xml" href="images/favicon.svg" />
</head>

<body>
  <!-- HEADER -->
  <header class="header" id="header">
    <div class="container">
      <nav class="nav">
        <a href="index.html" class="nav-logo">
          <div class="nav-logo-icon">24</div>
          <span class="nav-logo-text">24Dismil.com</span>
        </a>
        <button class="nav-city" id="citySelectorBtn">
          <i class="fa-solid fa-location-dot"></i> Delhi NCR
          <i class="fa-solid fa-chevron-down" style="font-size: 0.8em"></i>
        </button>
        <div class="nav-links">
          <a href="index.html" class="nav-link">Home</a>
          <a href="properties.html?type=buy" class="nav-link">Buy</a>
          <a href="properties.html?type=rent" class="nav-link">Rent</a>
          <a href="properties.html?type=commercial" class="nav-link">Commercial</a>

        </div>
        <div class="nav-actions">
          <a href="login.html" class="nav-btn-login">Login</a>
          <a href="post-property.html" class="nav-btn-post">+ Post FREE Property</a>
        </div>
        <div class="hamburger" id="hamburger">
          <span></span><span></span><span></span>
        </div>
      </nav>
    </div>
    <div class="mobile-menu" id="mobileMenu">
      <a href="index.html"><i class="fa-solid fa-house"></i> Home</a>
      <a href="properties.html?type=buy"><i class="fa-solid fa-cart-shopping"></i> Buy Property</a>
      <a href="properties.html?type=rent"><i class="fa-solid fa-key"></i> Rent Property</a>
      <a href="properties.html?type=commercial"><i class="fa-solid fa-building"></i> Commercial</a>

      <a href="login.html" style="color: var(--primary); font-weight: 700"><i class="fa-solid fa-right-to-bracket"></i>
        Login</a>
    </div>
  </header>

  <!-- AUTH CARD -->
  <div class="auth-wrap">
    <div class="auth-card">
      <div class="auth-logo">
        <a href="index.html"><i class="fa-solid fa-house"></i> 24Dismil.com</a>
        <p style="color: var(--text-muted); font-size: 13px; margin-top: 4px">
          India's Most Trusted Real Estate Portal
        </p>
      </div>

      <!-- Tabs -->
      <div class="auth-tabs">
        <div class="auth-tab active" id="tabLogin" onclick="switchTab('login')">
          Login
        </div>
        <div class="auth-tab" id="tabRegister" onclick="switchTab('register')">
          Register
        </div>
      </div>

      <!-- Error -->
      <div class="auth-err" id="authErr"></div>

      <!-- Google login (UI only ‚Äî functionality coming soon) -->
      <button class="google-btn" id="googleBtn" onclick="googleSignIn()">
        <svg width="18" height="18" viewBox="0 0 18 18">
          <path fill="#4285F4"
            d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" />
          <path fill="#34A853"
            d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z" />
          <path fill="#FBBC05"
            d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" />
          <path fill="#EA4335"
            d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z" />
        </svg>
        Continue with Google
      </button>
      <div class="auth-divider">‚Äî or ‚Äî</div>

      <!-- LOGIN FORM -->
      <div class="auth-form active" id="formLogin">
        <div class="auth-input-wrap">
          <label class="auth-label">Email Address</label>
          <input type="email" id="loginEmail" class="auth-input" placeholder="your@email.com" />
        </div>
        <div class="auth-input-wrap">
          <label class="auth-label">Password</label>
          <div class="pass-wrap">
            <input type="password" id="loginPassword" class="auth-input" placeholder="Your password" />
            <span class="pass-toggle" onclick="togglePass('loginPassword', this)"><i class="fa-solid fa-eye"></i></span>
          </div>
        </div>
        <button class="auth-btn" id="loginBtn" onclick="doLogin()">
          <i class="fa-solid fa-lock"></i> Login
        </button>
        <div class="auth-switch">
          Don't have an account?
          <a href="#" onclick="
                switchTab('register');
                return false;
              ">Register here</a>
        </div>
      </div>

      <!-- REGISTER FORM -->
      <div class="auth-form" id="formRegister">
        <div class="auth-input-wrap">
          <label class="auth-label">Full Name</label>
          <input type="text" id="regName" class="auth-input" placeholder="Your full name" />
        </div>
        <div class="auth-input-wrap">
          <label class="auth-label">Email Address</label>
          <input type="email" id="regEmail" class="auth-input" placeholder="your@email.com" />
        </div>
        <div class="auth-input-wrap">
          <label class="auth-label">Password</label>
          <div class="pass-wrap">
            <input type="password" id="regPassword" class="auth-input" placeholder="Minimum 6 characters" />
            <span class="pass-toggle" onclick="togglePass('regPassword', this)"><i class="fa-solid fa-eye"></i></span>
          </div>
        </div>
        <div class="auth-input-wrap">
          <label class="auth-label">Confirm Password</label>
          <input type="password" id="regConfirm" class="auth-input" placeholder="Re-enter password" />
        </div>
        <button class="auth-btn" id="registerBtn" onclick="doRegister()">
          <i class="fa-solid fa-rocket"></i> Create Account
        </button>
        <div class="auth-switch">
          Already have an account?
          <a href="#" onclick="
                switchTab('login');
                return false;
              ">Login here</a>
        </div>
      </div>
    </div>
  </div>

  <script src="js/properties.js"></script>
  <script src="js/main.js"></script>
  <script type="module">
    // ============================================================
    // FIREBASE CONFIG ‚Äî Replace with your actual Firebase config
    // Get it from: Firebase Console > Project Settings > Web App
    // ============================================================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { login, register, saveSession } from "./js/auth.js";
    import { getCachedUser } from "./js/auth.js";
    import { convex } from "./js/convex.js";

    function getRedirect() {
      const params = new URLSearchParams(window.location.search);
      return params.get("redirect") || "dashboard.html";
    }

    const firebaseConfig = {
      apiKey: "AIzaSyA2n0kGXRXCWwe80T5F338K3wMIz1x_QQ8",
      authDomain: "dismil-9cb39.firebaseapp.com",
      projectId: "dismil-9cb39",
      storageBucket: "dismil-9cb39.firebasestorage.app",
      messagingSenderId: "899698617404",
      appId: "1:899698617404:web:996cb3525d6e8d3ca6e739",
      measurementId: "G-MJ8E71N9QV",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Google Sign-In (Reverted to Popup for better UX)
    window.googleSignIn = async () => {
      const btn = document.getElementById("googleBtn");
      btn.disabled = true;
      btn.innerHTML =
        '<span style="display:flex;align-items:center;gap:8px;justify-content:center">‚è≥ Signing in...</span>';
      document.getElementById("authErr").style.display = "none";
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        console.log("Google Login Success! UID:", user.uid);

        // Get properly signed token from Convex
        const convexResult = await convex.mutation("auth:googleLogin", {
          email: user.email,
          name: user.displayName || user.email,
          photoUrl: user.photoURL || undefined,
          googleId: user.uid,
        });

        // Save session using Convex token
        saveSession(convexResult.token, {
          name: convexResult.name,
          email: convexResult.email,
          photo: user.photoURL,
          provider: "google",
        });

        const redirectUrl = getRedirect();
        window.location.assign(redirectUrl);
      } catch (err) {
        console.error("Google Login Error:", err);
        let msg = err.message || "Google Sign-In failed. Please try again.";
        if (err.code === "auth/popup-closed-by-user")
          msg = "Sign-in popup was closed. Please try again.";
        if (err.code === "auth/popup-blocked")
          msg =
            "Popup blocked by browser. Please allow popups for this site.";

        showError(`${msg} (${err.code || 'unknown_error'})`);
        btn.disabled = false;
        btn.innerHTML = `<svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z"/></svg> Continue with Google`;
      }
    };

    // Mode check: if ?mode=register, show register tab by default
    const params = new URLSearchParams(window.location.search);
    const mode = params.get("mode");

    window.switchTab = (tab) => {
      document
        .getElementById("formLogin")
        .classList.toggle("active", tab === "login");
      document
        .getElementById("formRegister")
        .classList.toggle("active", tab === "register");
      document
        .getElementById("tabLogin")
        .classList.toggle("active", tab === "login");
      document
        .getElementById("tabRegister")
        .classList.toggle("active", tab === "register");
      document.getElementById("authErr").style.display = "none";
    };

    if (mode === "register") {
      switchTab("register");
    }

    // Already logged in? redirect

    window.togglePass = (id, el) => {
      const input = document.getElementById(id);
      const isPass = input.type === "password";
      input.type = isPass ? "text" : "password";
      el.innerHTML = isPass
        ? '<i class="fa-solid fa-eye-slash"></i>'
        : '<i class="fa-solid fa-eye"></i>';
    };

    function showError(msg) {
      const el = document.getElementById("authErr");
      el.textContent = msg;
      el.style.display = "block";
    }

    window.doLogin = async () => {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;
      if (!email || !password)
        return showError("Please enter email and password.");
      const btn = document.getElementById("loginBtn");
      btn.textContent = "Logging in...";
      btn.disabled = true;
      document.getElementById("authErr").style.display = "none";
      try {
        const result = await login(email, password);
        const redirectUrl = result.isAdmin ? "admin.html" : getRedirect();
        window.location.href = redirectUrl;
      } catch (err) {
        showError(err.message || "Login failed. Try again.");
      } finally {
        btn.textContent = "üîê Login";
        btn.disabled = false;
      }
    };

    window.doRegister = async () => {
      const name = document.getElementById("regName").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const password = document.getElementById("regPassword").value;
      const confirm = document.getElementById("regConfirm").value;
      if (!name || !email || !password)
        return showError("All fields are required.");
      if (password.length < 6)
        return showError("Password must be at least 6 characters.");
      if (password !== confirm) return showError("Passwords do not match.");
      const btn = document.getElementById("registerBtn");
      btn.textContent = "Creating account...";
      btn.disabled = true;
      document.getElementById("authErr").style.display = "none";
      try {
        const result = await register(name, email, password);
        const redirectUrl = result.isAdmin ? "admin.html" : getRedirect();
        window.location.href = redirectUrl;
      } catch (err) {
        showError(err.message || "Registration failed. Try again.");
      } finally {
        btn.textContent = "üöÄ Create Account";
        btn.disabled = false;
      }
    };

    // Enter key support
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        if (document.getElementById("formLogin").classList.contains("active"))
          window.doLogin();
        else window.doRegister();
      }
    });
  </script>
  <script src="js/city-selector.js"></script>

</body>

</html>