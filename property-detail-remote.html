<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luxurious 3 BHK Flat in Sector 62 Noida | 24Dismil.com</title>
  <meta name="description"
    content="3 BHK apartment for sale at â‚¹85 Lakh in Sector 62, Noida. 1450 sq.ft, ready to move, swimming pool, gym, 24x7 security. RERA registered.">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/responsive.css">
  <link rel="stylesheet" href="css/city-dropdown.css">
  <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
  <style>
    /* ---- Gallery skeleton shimmer ---- */
    .gallery-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.4s infinite;
    }

    @keyframes shimmer {
      0% {
        background-position: 200% 0
      }

      100% {
        background-position: -200% 0
      }
    }

    .gallery-main img,
    .gallery-thumb img {
      transition: opacity 0.4s ease;
    }

    /* ---- Clickable gallery ---- */
    .gallery-main,
    .gallery-thumb {
      cursor: zoom-in;
    }

    /* ---- Lightbox ---- */
    #photolightbox {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.95);
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #photolightbox.open {
      display: flex;
      animation: lbFade 0.2s ease;
    }

    @keyframes lbFade {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }

    #lbClose {
      position: absolute;
      top: 16px;
      right: 20px;
      font-size: 32px;
      color: #fff;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
      z-index: 10;
      background: none;
      border: none;
      line-height: 1;
    }

    #lbClose:hover {
      opacity: 1;
    }

    #lbCounter {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255, 255, 255, 0.7);
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 1px;
    }

    #lbMainImg {
      max-width: 90vw;
      max-height: 80vh;
      object-fit: contain;
      border-radius: 4px;
      transition: opacity 0.25s;
    }

    #lbPrev,
    #lbNext {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.12);
      border: none;
      color: #fff;
      font-size: 28px;
      width: 52px;
      height: 52px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      z-index: 10;
    }

    #lbPrev {
      left: 12px;
    }

    #lbNext {
      right: 12px;
    }

    #lbPrev:hover,
    #lbNext:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    #lbThumbs {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      overflow-x: auto;
      max-width: 90vw;
      padding: 4px;
      scrollbar-width: thin;
    }

    .lb-thumb {
      width: 60px;
      height: 46px;
      object-fit: cover;
      border-radius: 4px;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.2s;
      flex-shrink: 0;
      border: 2px solid transparent;
    }

    .lb-thumb.active {
      opacity: 1;
      border-color: var(--primary, #e84b1e);
    }

    .lb-thumb:hover {
      opacity: 0.85;
    }
  </style>

  <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
</head>

<body>
  <!-- PHOTO LIGHTBOX MODAL -->
  <div id="photolightbox" role="dialog" aria-modal="true" aria-label="Photo viewer">
    <button id="lbClose" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
    <div id="lbCounter">1 / 1</div>
    <button id="lbPrev" aria-label="Previous photo"><i class="fa-solid fa-chevron-left"></i></button>
    <img id="lbMainImg" src="" alt="Property photo">
    <button id="lbNext" aria-label="Next photo"><i class="fa-solid fa-chevron-right"></i></button>
    <div id="lbThumbs"></div>
  </div>

  <!-- ADVERTISER MODAL (Modern Redesign) -->
  <div class="adv-modal-overlay" id="advModal">
    <div class="adv-modal-content">
      <!-- Modern Header -->
      <div class="adv-header">
        <div class="adv-owner-profile">
          <div class="adv-avatar"><i class="fa-solid fa-user-lock"></i></div>
          <div class="adv-owner-details">
            <div class="adv-owner-name" id="advNameDisplay">Name Hidden</div>
            <div class="adv-owner-role">Property Owner</div>
            <div class="adv-owner-phone" id="advPhoneDisplay">+91 98*** 543**</div>
          </div>
        </div>
        <button class="adv-close" id="advModalClose"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <!-- Warning/Instruction -->
      <div class="adv-alert">
        <i class="fa-solid fa-shield-halved"></i> Please share your details to unlock the owner's contact info.
      </div>

      <!-- Body -->
      <div class="adv-body">
        <div class="adv-grid">

          <!-- Left Column: Primary Info -->
          <div class="adv-form-section">
            <h4 class="adv-title">Basic Information</h4>

            <div class="adv-group">
              <label class="adv-label">Property interested for?</label>
              <div class="adv-chips" id="chipReason">
                <div class="adv-chip" data-val="Investment">Investment</div>
                <div class="adv-chip active" data-val="Self Use">Self Use</div>
              </div>
              <input type="hidden" id="valReason" value="Self Use">
            </div>

            <div class="adv-group">
              <label class="adv-label">Are you a property dealer?</label>
              <div class="adv-chips" id="chipDealer">
                <div class="adv-chip" data-val="Yes">Yes</div>
                <div class="adv-chip active" data-val="No">No</div>
              </div>
              <input type="hidden" id="valDealer" value="No">
            </div>

            <div class="adv-input-row" style="margin-top:24px;">
              <div class="adv-input-wrap">
                <i class="fa-regular fa-user adv-input-icon"></i>
                <input type="text" id="advInputName" class="adv-input-text" placeholder="Your Full Name">
              </div>
            </div>

            <div class="adv-input-wrap">
              <i class="fa-solid fa-mobile-screen adv-input-icon"></i>
              <span class="adv-prefix">+91 IND</span>
              <input type="tel" id="advInputPhone" class="adv-input-text" placeholder="Mobile Number"
                style="padding-left:106px;">
            </div>
          </div>

          <!-- Right Column: Optional Info -->
          <div class="adv-form-section">
            <h4 class="adv-title">Additional Preferences</h4>

            <div class="adv-group">
              <label class="adv-label">Planning to buy in?</label>
              <div class="adv-chips" id="chipTimeframe">
                <div class="adv-chip" data-val="3 months">3 Months</div>
                <div class="adv-chip" data-val="6 months">6 Months</div>
                <div class="adv-chip active" data-val="More than 6 months">More than 6 months</div>
              </div>
              <input type="hidden" id="valTimeframe" value="More than 6 months">
            </div>

            <div class="adv-checks">
              <label class="adv-check-label">
                <input type="checkbox" id="advCheckLoan" class="adv-checkbox">
                <span class="adv-check-text">I am interested in Home Loan assistance</span>
              </label>
              <label class="adv-check-label">
                <input type="checkbox" id="advCheckVisit" class="adv-checkbox" checked>
                <span class="adv-check-text">I am interested in Site Visits</span>
              </label>
              <label class="adv-check-label" style="margin-top:12px;">
                <input type="checkbox" id="advCheckTerms" class="adv-checkbox">
                <span class="adv-check-text">I agree to the <a href="terms.html">Terms</a> & <a
                    href="privacy.html">Privacy Policy</a></span>
              </label>
            </div>

            <button class="adv-submit-btn" id="advBtnSubmit">Get Contact Details</button>
            <div id="advSuccessMsg" class="adv-success-box" style="display:none;">
              <i class="fa-solid fa-circle-check"></i> Details shared! Contact information is now visible above.
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    // Simple script to handle chip selection clicks securely without breaking scope
    document.addEventListener("DOMContentLoaded", () => {
      const chipGroups = [
        { id: 'chipReason', inputId: 'valReason' },
        { id: 'chipDealer', inputId: 'valDealer' },
        { id: 'chipTimeframe', inputId: 'valTimeframe' }
      ];

      chipGroups.forEach(group => {
        const wrap = document.getElementById(group.id);
        const input = document.getElementById(group.inputId);
        if (!wrap || !input) return;

        const chips = wrap.querySelectorAll('.adv-chip');
        chips.forEach(chip => {
          chip.addEventListener('click', () => {
            chips.forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            input.value = chip.getAttribute('data-val');
          });
        });
      });
    });
  </script>

  <!-- HEADER -->

  <header class="header" id="header">
    <div class="container">
      <nav class="nav">
        <div class="nav-group nav-group-left">
          <a href="index.html" class="nav-logo">
            <div class="nav-logo-icon">24</div>
            <span class="nav-logo-text">24Dismil.com</span>
          </a>
          <button class="nav-city" id="citySelectorBtn">
            <i class="fa-solid fa-location-dot"></i>
            <span id="currentCityText">Select City</span>
            <i class="fa-solid fa-chevron-down" style="font-size: 0.8em"></i>
          </button>
        </div>

        <div class="nav-links">
          <a href="index.html" class="nav-link">Home</a>
          <a href="properties.html?type=buy" class="nav-link active">Buy</a>
          <a href="properties.html?type=rent" class="nav-link">Rent</a>
        </div>

        <div class="nav-group nav-group-right">
          <div class="nav-actions">
            <a href="login.html" class="nav-btn-login">Login / Register</a>
            <a href="post-property.html" class="nav-btn-post"><i class="fa-solid fa-plus"></i> Post FREE Property</a>
          </div>
          <div class="hamburger" id="hamburger">
            <span></span><span></span><span></span>
          </div>
        </div>
      </nav>
    </div>
    <div class="mobile-menu" id="mobileMenu">
      <a href="index.html"><i class="fa-solid fa-house"></i> Home</a>
      <a href="properties.html"><i class="fa-solid fa-magnifying-glass"></i> Properties</a>
      <a href="login.html" style="color: var(--primary); font-weight: 700"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
    </div>
  </header>

  <!-- PAGE BREADCRUMB BAR -->
  <div style="background:#fff;border-bottom:1px solid var(--border);padding:14px 0;margin-top:64px">
    <div class="container">
      <div class="page-breadcrumb" style="color:var(--text-muted)">
        <a href="index.html" style="color:var(--text-muted)">Home</a> <i class="fa-solid fa-chevron-right"
          style="font-size:10px"></i>
        <a href="properties.html" style="color:var(--text-muted)">Properties</a> <i class="fa-solid fa-chevron-right"
          style="font-size:10px"></i>
        <span style="color:var(--text)">3 BHK Apartment in Noida</span>
      </div>
    </div>
  </div>

  <!-- MAIN DETAIL LAYOUT -->
  <div class="container">
    <div class="detail-layout">

      <!-- LEFT COLUMN -->
      <div>
        <!-- GALLERY -->
        <div class="detail-gallery" style="margin-top:24px">
          <div class="gallery-main gallery-skeleton">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
              alt="Property Main View" id="mainGalleryImg" style="opacity:0;width:100%;height:100%;object-fit:cover">
          </div>
          <div class="gallery-thumb gallery-skeleton" id="galleryThumb2">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
              alt="Property View 2" id="galleryImg2"
              style="opacity:0;cursor:pointer;width:100%;height:100%;object-fit:cover">
          </div>
          <div class="gallery-thumb gallery-skeleton" style="position:relative" id="galleryThumb3">
            <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
              alt="Property View 3" id="galleryImg3"
              style="opacity:0;cursor:pointer;width:100%;height:100%;object-fit:cover">
            <div class="gallery-more" id="galleryMore" style="display:none"></div>
          </div>
        </div>

        <!-- TITLE CARD -->
        <div class="detail-card">
          <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:16px;flex-wrap:wrap">
            <div>
              <div id="topTags" style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
                <!-- Dynamic Tags (BUY/RENT, Verified, RERA, etc.) injected here -->
              </div>
              <div class="detail-price">â‚¹--</div>
              <div id="priceStats" style="font-size:13px;color:var(--text-muted);margin-top:2px"></div>
              <h1 class="detail-title">Luxurious 3 BHK Flat in Premium Society</h1>
              <div class="detail-location"><i class="fa-solid fa-location-dot"></i> <a href="#"
                  style="color:var(--primary)">Sector 62</a>, Noida, Uttar Pradesh</div>
            </div>
            <div style="display:flex;gap:8px">
              <button
                style="width:40px;height:40px;border:1.5px solid var(--border);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:20px;cursor:pointer;transition:var(--transition)"
                title="Save" onmouseover="this.style.borderColor='var(--primary)'"
                onmouseout="this.style.borderColor='var(--border)'"><i class="fa-regular fa-heart"></i></button>
              <button
                style="width:40px;height:40px;border:1.5px solid var(--border);border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer"
                title="Share"><i class="fa-solid fa-share-nodes"></i></button>
            </div>
          </div>

          <!-- SPEC CARDS -->
          <div class="detail-specs">
            <div class="detail-spec">
              <div class="detail-spec-icon"><i class="fa-solid fa-bed"></i></div>
              <div class="detail-spec-value">3 BHK</div>
              <div class="detail-spec-label">Bedrooms</div>
            </div>
            <div class="detail-spec">
              <div class="detail-spec-icon"><i class="fa-solid fa-ruler-combined"></i></div>
              <div class="detail-spec-value">1,450 sq.ft</div>
              <div class="detail-spec-label">Built-up Area</div>
            </div>
            <div class="detail-spec">
              <div class="detail-spec-icon"><i class="fa-solid fa-compass"></i></div>
              <div class="detail-spec-value">East</div>
              <div class="detail-spec-label">Facing</div>
            </div>
            <div class="detail-spec">
              <div class="detail-spec-icon"><i class="fa-solid fa-building"></i></div>
              <div class="detail-spec-value">8th / 18</div>
              <div class="detail-spec-label">Floor</div>
            </div>
            <div class="detail-spec">
              <div class="detail-spec-icon"><i class="fa-solid fa-car"></i></div>
              <div class="detail-spec-value">1 Covered</div>
              <div class="detail-spec-label">Parking</div>
            </div>
            <div class="detail-spec">
              <div class="detail-spec-icon"><i class="fa-solid fa-calendar-days"></i></div>
              <div class="detail-spec-value">Jan 2020</div>
              <div class="detail-spec-label">Built On</div>
            </div>
          </div>
        </div>

        <!-- DESCRIPTION -->
        <div class="detail-card">
          <h2 style="font-size:18px;font-weight:700;color:var(--dark);margin-bottom:14px">Property Description</h2>
          <p id="dynamicDescription"
            style="font-size:14px;color:var(--text-muted);line-height:1.8;white-space:pre-wrap;">No description provided
            for this property.</p>
          <div id="detailTags" style="margin-top:16px;display:flex;gap:8px;flex-wrap:wrap">
            <!-- Dynamic Tags will be injected here -->
          </div>
        </div>

        <!-- AMENITIES -->
        <div class="detail-card">
          <h2 style="font-size:18px;font-weight:700;color:var(--dark);margin-bottom:16px">Amenities & Features</h2>
          <div class="amenities-grid">
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-swimming-pool"></i></div> Swimming Pool
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-dumbbell"></i></div> Fully Equipped Gym
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-house-chimney-user"></i></div> Clubhouse
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-shield-halved"></i></div> 24x7 Security
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-bolt"></i></div> Power Backup
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-elevator"></i></div> High-Speed Lifts
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-tree"></i></div> Landscaped Garden
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-car"></i></div> Covered Parking
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-gamepad"></i></div> Children Play Area
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-fire-extinguisher"></i></div> Fire Safety
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-walkie-talkie"></i></div> Intercom
            </div>
            <div class="amenity-item">
              <div class="amenity-icon"><i class="fa-solid fa-recycle"></i></div> Waste Management
            </div>
          </div>
        </div>

        <!-- EMI CALCULATOR -->
        <div class="detail-card">
          <h2 style="font-size:18px;font-weight:700;color:var(--dark);margin-bottom:16px"><i
              class="fa-solid fa-calculator"></i> EMI Calculator</h2>
          <div class="emi-inputs">
            <div class="emi-field">
              <div class="emi-field-val" style="margin-bottom:6px">
                <label style="font-size:12px;font-weight:600;color:var(--text-muted)">Loan Amount</label>
                <span id="emi-loan-val" style="font-size:13px;font-weight:700;color:var(--dark)">â‚¹68L</span>
              </div>
              <input type="range" id="emi-loan" min="500000" max="50000000" step="500000" value="6800000">
            </div>
            <div class="emi-field">
              <div class="emi-field-val" style="margin-bottom:6px">
                <label style="font-size:12px;font-weight:600;color:var(--text-muted)">Interest Rate (per annum)</label>
                <span id="emi-rate-val" style="font-size:13px;font-weight:700;color:var(--dark)">8.5%</span>
              </div>
              <input type="range" id="emi-rate" min="6" max="15" step="0.1" value="8.5">
            </div>
            <div class="emi-field">
              <div class="emi-field-val" style="margin-bottom:6px">
                <label style="font-size:12px;font-weight:600;color:var(--text-muted)">Loan Tenure</label>
                <span id="emi-tenure-val" style="font-size:13px;font-weight:700;color:var(--dark)">20 yrs</span>
              </div>
              <input type="range" id="emi-tenure" min="5" max="30" step="1" value="20">
            </div>
          </div>
          <div class="emi-result">
            <div class="emi-amount" id="emi-result">â‚¹--</div>
            <div class="emi-label">Estimated Monthly EMI</div>
          </div>
          <p style="font-size:11px;color:var(--text-muted);margin-top:10px;text-align:center">*Approximate value. Actual
            EMI may vary based on bank policies.</p>
        </div>

        <!-- LOCATION -->
        <div class="detail-card">
          <h2 style="font-size:18px;font-weight:700;color:var(--dark);margin-bottom:14px"><i
              class="fa-solid fa-location-dot"></i> Location Map</h2>
          <div
            style="background:var(--bg);border-radius:var(--radius-sm);height:260px;display:flex;align-items:center;justify-content:center;border:2px dashed var(--border);flex-direction:column;gap:10px">
            <div style="font-size:40px"><i class="fa-solid fa-map-location-dot"></i></div>
            <p style="font-size:14px;color:var(--text-muted)">Sector 62, Noida, Uttar Pradesh 201301</p>
            <a href="https://maps.google.com?q=Sector+62+Noida" target="_blank" class="btn btn-outline btn-sm">Open in
              Google Maps â†—</a>
          </div>
          <!-- Removed hardcoded map distances -->
        </div>
      </div>

      <!-- RIGHT COLUMN â€” CONTACT CARD -->
      <div style="margin-top:24px">
        <!-- NEW VIEW ADVERTISER CARD -->
        <div class="contact-card" style="text-align: center; padding: 32px 24px;">
          <h3 style="font-size: 20px; font-weight: 800; color: var(--dark); margin-bottom: 8px;">Interested in this
            property?</h3>
          <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 24px;">Get complete details and contact
            the owner directly.</p>
          <button class="adv-submit-btn" id="btnOpenAdvModal" style="margin-top: 0;">View Advertiser Details</button>
        </div>

        <!-- OLD CONTACT CARD (Kept for fallback/emails but hidden by default to prefer new modal) -->
        <div class="contact-card" style="margin-top:24px; display: none;">
          <h3>Contact Owner / Agent</h3>
          <p>Get more details about this property for FREE</p>
          <div class="contact-form-group">
            <label>Your Name</label>
            <input type="text" id="contactName" placeholder="Enter your full name">
          </div>
          <div class="contact-form-group">
            <label>Mobile Number</label>
            <input type="tel" id="contactPhone" placeholder="+91 XXXXX XXXXX">
          </div>
          <div class="contact-form-group">
            <label>Email (Optional)</label>
            <input type="email" id="contactEmail" placeholder="your@email.com">
          </div>
          <div class="contact-form-group">
            <label>Message</label>
            <textarea id="contactMessage" rows="3"
              placeholder="Hi, I am interested in this property. Please contact me.">Hi, I am interested in this property. Please contact me.</textarea>
          </div>
          <div class="contact-btns">
            <button class="contact-btn contact-btn-call" id="btnCallNow"><i class="fa-solid fa-phone"></i> Call
              Now</button>
            <button class="contact-btn contact-btn-wa" id="btnWhatsApp"><i class="fa-brands fa-whatsapp"></i>
              WhatsApp</button>
            <button class="contact-btn contact-btn-email" id="btnSendEnquiry"><i class="fa-solid fa-envelope"></i> Send
              Enquiry</button>
          </div>
          <div id="contactSuccess"
            style="display:none; color:#10b981; font-weight:bold; margin-top:14px; text-align:center; padding:10px; background:rgba(16,185,129,0.1); border-radius:8px;">
            <i class="fa-solid fa-circle-check"></i> Enquiry Sent Successfully!
          </div>
          <div id="contactLoader" class="loader" style="display:none; margin: 10px auto;"></div>
          <p style="font-size:11px;color:var(--text-muted);text-align:center;margin-top:14px">By submitting, you agree
            to our <a href="#" style="color:var(--primary)">Terms</a> & <a href="#" style="color:var(--primary)">Privacy
              Policy</a></p>
        </div>

        <!-- SELLER CARD -->
        <div class="detail-card" style="margin-top:16px">
          <h3 style="font-size:15px;font-weight:700;color:var(--dark);margin-bottom:14px">Listed By</h3>
            <div id="ownerAvatar"
              style="width:48px;height:48px;background:linear-gradient(135deg,var(--primary),var(--primary-light));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;font-weight:700">
              R</div>
            <div>
              <div id="ownerName" style="font-weight:700;font-size:15px;color:var(--dark)">Rajesh Kumar</div>
              <div id="ownerJoinDate" style="font-size:12px;color:var(--text-muted)"><i class="fa-solid fa-user-tag"></i> Owner Â· Member
                since 2019</div>
              <div style="font-size:12px;color:var(--success)"><i class="fa-solid fa-circle-check"></i> ID Verified
              </div>
            </div>
          <div
            style="background:var(--bg);border-radius:var(--radius-sm);padding:12px;font-size:13px;color:var(--text-muted);line-height:1.6">
            ðŸ”’ Phone number visible after contacting
          </div>
        </div>

        <!-- KEY HIGHLIGHTS -->
        <div id="keyHighlightsCard" class="detail-card" style="margin-top:16px; display: none;">
          <h3 style="font-size:15px;font-weight:700;color:var(--dark);margin-bottom:14px">Key Highlights</h3>
          <div id="keyHighlightsList" style="display:flex;flex-direction:column;gap:10px">
            <!-- Dynamic Highlights will be injected here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SIMILAR PROPERTIES -->
  <section class="section" style="background:var(--bg)">
    <div class="container">
      <div class="section-header" style="text-align:left;margin-bottom:24px">
        <h2 style="font-size:22px">Similar Properties You May Like</h2>
      </div>
      <div class="cards-slider-wrap">
        <div class="cards-slider" id="similarPropertiesSlider">
          <!-- Dynamic Similar Properties will be injected here -->
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="footer-logo">
            <div class="nav-logo-icon">24</div>
            24Dismil.com
          </div>
          <p class="footer-tagline">
            India's most trusted real estate portal. Find your dream property
            with verified listings, expert guidance, and market insights.
          </p>
          <div class="footer-socials">
            <a href="#" class="social-icon"><i class="fa-brands fa-facebook"></i></a>
            <a href="#" class="social-icon"><i class="fa-brands fa-instagram"></i></a>
            <a href="#" class="social-icon"><i class="fa-brands fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fa-brands fa-linkedin"></i></a>
            <a href="#" class="social-icon"><i class="fa-brands fa-youtube"></i></a>
          </div>
        </div>
        <div class="footer-col">
          <h4>Quick Links</h4>
          <div class="footer-links">
            <a href="pricing.html">Pricing</a>
            <a href="properties.html?type=buy">Buy Properties</a>
            <a href="properties.html?type=rent">Rent Properties</a>
            <a href="properties.html?type=commercial">Commercial</a>
            <a href="post-property.html">Post Free Property</a>
            <a href="properties.html?newLaunch=true">New Projects</a>
            <a href="about.html">About Us</a>
            <a href="contact.html">Contact</a>
          </div>
        </div>
        <div class="footer-col">
          <h4>Resources</h4>
          <div class="footer-links">
            <a href="#">EMI Calculator</a>
            <a href="#">Property Rates</a>
            <a href="#">RERA Guide</a>
            <a href="#">Home Loan</a>
            <a href="#">Legal Guide</a>
            <a href="#">Vastu Tips</a>
            <a href="#">Blog & News</a>
            <a href="#">FAQ</a>
          </div>
        </div>
        <div class="footer-col footer-col-cities">
          <h4>Top Cities</h4>
          <div class="footer-links footer-cities-grid">
            <a href="properties.html?city=Mumbai">Mumbai</a>
            <a href="properties.html?city=Delhi NCR">Delhi NCR</a>
            <a href="properties.html?city=Bangalore">Bangalore</a>
            <a href="properties.html?city=Hyderabad">Hyderabad</a>
            <a href="properties.html?city=Pune">Pune</a>
            <a href="properties.html?city=Chennai">Chennai</a>
            <a href="properties.html?city=Kolkata">Kolkata</a>
            <a href="properties.html?city=Noida">Noida</a>
            <a href="properties.html?city=Ahmedabad">Ahmedabad</a>
            <a href="properties.html?city=Jaipur">Jaipur</a>
            <a href="properties.html?city=Patna">Patna</a>
            <a href="properties.html?city=Lucknow">Lucknow</a>
          </div>
        </div>
        <div class="footer-col footer-download">
          <h4>Download Our App</h4>
          <p class="footer-download-text">Search and shortlist properties on the go.</p>
          <div class="footer-badges">
            <a href="#" onclick="showToast('Coming Soon!', 'success'); return false;">
              <img src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg"
                alt="Download on the App Store" class="app-badge">
            </a>
            <a href="#" onclick="showToast('Coming Soon!', 'success'); return false;">
              <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
                alt="Get it on Google Play" class="app-badge">
            </a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <span>Â© 2025 24Dismil.com. All rights reserved. | India's #1 Real Estate Portal</span>
        <div class="footer-bottom-links">
          <a href="privacy.html">Privacy Policy</a>
          <a href="terms.html">Terms of Use</a>
          <a href="#">Sitemap</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="js/properties.js"></script>
  <script src="js/main.js"></script>

  <script>
    // ---- Default Contact Button Handlers (static / demo fallback) ----
    // These run immediately and work even without a property ID in the URL.
    // When a real property loads from DB, these get overridden below.

    // Default contact number (shown when no property is loaded from DB)
    const DEFAULT_PHONE = '9999999999'; // Change this to your actual contact number

    document.getElementById('btnCallNow').addEventListener('click', function () {
      var phone = this.dataset.phone || DEFAULT_PHONE;
      window.location.href = 'tel:' + phone;
    });

    document.getElementById('btnWhatsApp').addEventListener('click', function () {
      var name = document.getElementById('contactName')?.value.trim() || '';
      var phone = this.dataset.phone || DEFAULT_PHONE;
      var msg = document.getElementById('contactMessage')?.value.trim() ||
        'Hi, I am interested in this property. Please contact me.';
      var text = encodeURIComponent((name ? 'Name: ' + name + '\n' : '') + msg);
      window.open('https://wa.me/91' + phone + '?text=' + text, '_blank');
    });

    document.getElementById('btnSendEnquiry').addEventListener('click', async function () {
      var name = document.getElementById('contactName')?.value.trim();
      var phone = document.getElementById('contactPhone')?.value.trim();
      var email = document.getElementById('contactEmail')?.value.trim();
      var message = document.getElementById('contactMessage')?.value.trim();
      var successMsg = document.getElementById('contactSuccess');
      var loader = document.getElementById('contactLoader');

      if (!name || !phone) {
        alert('Please enter your Name and Mobile Number.');
        return;
      }

      // If the DB-based handler has been attached (via module script below),
      // this default handler is replaced and won't run. But if no ?id= in URL
      // OR contactOwner mutation is unavailable, we show a friendly success.
      this.style.display = 'none';
      if (loader) loader.style.display = 'block';

      // Simulate small delay for UX
      await new Promise(r => setTimeout(r, 800));

      if (loader) loader.style.display = 'none';
      if (successMsg) successMsg.style.display = 'block';

      // Clear fields
      document.getElementById('contactName').value = '';
      document.getElementById('contactPhone').value = '';
      document.getElementById('contactEmail').value = '';
      document.getElementById('contactMessage').value = 'Hi, I am interested in this property. Please contact me.';

      var btn = this;
      setTimeout(function () {
        if (successMsg) successMsg.style.display = 'none';
        btn.style.display = 'inline-block';
      }, 5000);
    });

    // ---- NEW ADVERTISER MODAL FALLBACK LOGIC ----
    const advModal = document.getElementById('advModal');
    const btnOpenAdvModal = document.getElementById('btnOpenAdvModal');
    const advModalClose = document.getElementById('advModalClose');
    const advBtnSubmit = document.getElementById('advBtnSubmit');

    // Elements to update in modal header
    const advHeaderPhone = document.getElementById('advPhoneDisplay');
    const advHeaderName = document.getElementById('advNameDisplay');
    const advDateDisplay = document.getElementById('advDateDisplay');
    const advPriceAddress = document.getElementById('advPriceAddress');
    const advAreaType = document.getElementById('advAreaType');

    // Fallback defaults for static page
    let REAL_OWNER_PHONE = DEFAULT_PHONE;
    let REAL_OWNER_NAME = "Rajesh Kumar";
    let PROPERTY_ID = null;

    function maskPhone(phone) {
      if (!phone) return '+91 98***543**';
      return '+91 ' + phone.substring(0, 2) + '***' + phone.substring(5, 8) + '**';
    }

    if (btnOpenAdvModal) {
      btnOpenAdvModal.addEventListener('click', () => {
        advModal.classList.add('open');
        document.body.style.overflow = 'hidden';
        // Set masked phone and hidden name on open
        advHeaderPhone.textContent = maskPhone(REAL_OWNER_PHONE);
        advHeaderName.textContent = 'Name Hidden';
      });
    }

    function closeAdvModal() {
      advModal.classList.remove('open');
      document.body.style.overflow = '';

      // reset form states
      document.getElementById('advSuccessMsg').style.display = 'none';
      advBtnSubmit.style.display = 'block';
      advBtnSubmit.textContent = 'View Advertiser Details';
      advBtnSubmit.disabled = false;
    }

    if (advModalClose) advModalClose.addEventListener('click', closeAdvModal);
    if (advModal) {
      advModal.addEventListener('click', (e) => {
        if (e.target === advModal) closeAdvModal();
      });
    }

    // Fallback form submit
    if (advBtnSubmit) {
      advBtnSubmit.addEventListener('click', async function () {
        const nameEl = document.getElementById('advInputName');
        const phoneEl = document.getElementById('advInputPhone');
        const termsEl = document.getElementById('advCheckTerms');

        if (!nameEl.value.trim() || !phoneEl.value.trim()) {
          alert('Please enter your Name and Mobile Number.');
          return;
        }
        if (!termsEl.checked) {
          alert('Please agree to the Terms & Conditions.');
          return;
        }

        this.disabled = true;
        this.textContent = 'Submitting...';

        // Fallback submit delay
        await new Promise(r => setTimeout(r, 800));

        // Success UI update
        this.style.display = 'none';
        document.getElementById('advSuccessMsg').style.display = 'block';

        // Reveal owner details
        advHeaderPhone.textContent = '+91 ' + REAL_OWNER_PHONE;
        advHeaderName.textContent = REAL_OWNER_NAME;

        // Reset fields
        nameEl.value = '';
        phoneEl.value = '';
        termsEl.checked = false;
      });
    }

  </script>
  <script type="module">
    import { convex } from './js/convex.js';

    (async () => {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');
      if (!id) return; // no ID = show default hardcoded page

      try {
        const p = await convex.query('properties:getProperty', { id });
        if (!p) return;

        // ---- Resolve photo URLs (Robust version) ----
        const photos = (p.photos || []).map(item => {
          const url = typeof item === 'object' ? item.url : item;
          // Only return valid URL strings
          if (url && (typeof url === 'string' && (url.startsWith('http') || url.startsWith('/')))) {
            return url;
          }
          return null;
        }).filter(Boolean);
        if (photos.length === 0) photos.push('images/property-1.webp');

        // ---- Helpers ----
        const isLand = /plot|land/i.test(p.propertyType || '');
        const isCommercial = /commercial|shop|office|warehouse/i.test(p.propertyType || '');
        const bhk = p.details?.bhk;
        const price = p.pricing?.expectedPrice || 0;
        const area = p.details?.builtUpArea || 0;
        const priceStr = 'â‚¹' + price.toLocaleString('en-IN');
        const ppsf = area > 0 ? Math.round(price / area) : 0;

        // Title
        let title = p.propertyType;
        if (!isLand && !isCommercial && bhk && bhk !== '0') title = `${bhk} BHK ${p.propertyType}`;

        // ---- Update page title / breadcrumb ----
        document.title = `${title} in ${p.location?.locality || p.location?.city} | 24Dismil.com`;
        document.querySelector('.page-breadcrumb span')?.textContent && (
          document.querySelector('.page-breadcrumb span').textContent = title
        );

        // Gallery element refs
        const mainImg = document.getElementById('mainGalleryImg');
        const galleryImg2 = document.getElementById('galleryImg2');
        const galleryImg3 = document.getElementById('galleryImg3');
        const galleryThumb2 = document.getElementById('galleryThumb2');
        const galleryThumb3 = document.getElementById('galleryThumb3');
        const galleryMore = document.getElementById('galleryMore');

        // ---- Lightbox setup ----

        const lb = document.getElementById('photolightbox');
        const lbImg = document.getElementById('lbMainImg');
        const lbCounter = document.getElementById('lbCounter');
        const lbThumbs = document.getElementById('lbThumbs');
        let lbIndex = 0;

        function lbOpen(idx) {
          lbIndex = Math.max(0, Math.min(idx, photos.length - 1));
          lbImg.src = photos[lbIndex];
          lbCounter.textContent = `${lbIndex + 1} / ${photos.length}`;
          lbThumbs.querySelectorAll('.lb-thumb').forEach((t, i) => t.classList.toggle('active', i === lbIndex));
          lb.classList.add('open');
          document.body.style.overflow = 'hidden';
        }
        function lbClose() {
          lb.classList.remove('open');
          document.body.style.overflow = '';
        }
        function lbGo(delta) {
          lbOpen((lbIndex + delta + photos.length) % photos.length);
        }

        // Build thumbnail strip
        lbThumbs.innerHTML = photos.map((src, i) =>
          `<img class="lb-thumb ${i === 0 ? 'active' : ''}" src="${src}" data-idx="${i}" alt="Photo ${i + 1}">`
        ).join('');
        lbThumbs.querySelectorAll('.lb-thumb').forEach(t => {
          t.addEventListener('click', e => { e.stopPropagation(); lbOpen(parseInt(t.dataset.idx)); });
        });

        document.getElementById('lbClose').addEventListener('click', lbClose);
        document.getElementById('lbPrev').addEventListener('click', e => { e.stopPropagation(); lbGo(-1); });
        document.getElementById('lbNext').addEventListener('click', e => { e.stopPropagation(); lbGo(1); });
        lb.addEventListener('click', lbClose); // click backdrop to close
        lbImg.addEventListener('click', e => e.stopPropagation());
        document.addEventListener('keydown', e => {
          if (!lb.classList.contains('open')) return;
          if (e.key === 'ArrowLeft') lbGo(-1);
          if (e.key === 'ArrowRight') lbGo(1);
          if (e.key === 'Escape') lbClose();
        });
        // Touch swipe
        let touchStartX = 0;
        lb.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; }, { passive: true });
        lb.addEventListener('touchend', e => {
          const dx = e.changedTouches[0].clientX - touchStartX;
          if (Math.abs(dx) > 50) lbGo(dx < 0 ? 1 : -1);
        });

        // ---- Load gallery thumbnails ----
        function loadImg(imgEl, wrapEl, src, photoIdx) {
          if (!imgEl) return;
          const tmp = new Image();
          tmp.onload = () => {
            imgEl.src = src;
            imgEl.style.opacity = '1';
            if (wrapEl) wrapEl.classList.remove('gallery-skeleton');
          };
          tmp.src = src;
          imgEl.style.cursor = 'zoom-in';
          imgEl.addEventListener('click', () => lbOpen(photoIdx));
        }

        // Wire gallery images
        if (mainImg) {
          mainImg.style.cursor = 'zoom-in';
          mainImg.addEventListener('click', () => lbOpen(0));
          const tmp = new Image();
          tmp.onload = () => { mainImg.src = photos[0]; mainImg.style.opacity = '1'; mainImg.parentElement?.classList.remove('gallery-skeleton'); };
          tmp.src = photos[0];
        }
        if (photos[1]) loadImg(galleryImg2, galleryThumb2, photos[1], 1);
        else if (galleryThumb2) galleryThumb2.style.display = 'none';

        if (photos[2]) loadImg(galleryImg3, galleryThumb3, photos[2], 2);
        else if (galleryThumb3) galleryThumb3.style.display = 'none';

        // "+N Photos" badge â€” dynamic count
        if (galleryMore) {
          const extra = photos.length - 3;
          if (extra > 0) {
            galleryMore.textContent = `+${extra} Photos`;
            galleryMore.style.display = '';
            galleryMore.style.cursor = 'pointer';
            galleryMore.addEventListener('click', () => lbOpen(3));
          } else {
            galleryMore.style.display = 'none';
          }
        }
        // Also make gallery-more on thumb3's parent open lightbox
        if (galleryThumb3) galleryThumb3.addEventListener('click', () => lbOpen(2));


        // ---- Price & Title card ----
        const priceEl = document.querySelector('.detail-price');
        if (priceEl) priceEl.textContent = priceStr;

        const priceStats = document.getElementById('priceStats');
        if (priceStats) {
          let stats = [];
          if (ppsf > 0) stats.push(`â‚¹${ppsf.toLocaleString('en-IN')} per sq.ft`);
          if (p.pricing?.expectedPrice > 500000) {
            // Basic EMI math (approx 8.5% for 20y)
            const emi = Math.round((p.pricing.expectedPrice * 0.8) * 0.008678);
            stats.push(`EMI starts at â‚¹${emi.toLocaleString('en-IN')}/mo`);
          }
          priceStats.textContent = stats.join(' Â· ');
        }
        const detailTitle = document.querySelector('.detail-title');
        if (detailTitle) detailTitle.textContent = `${title} in ${p.location?.society || p.location?.locality || ''}`;
        const detailLoc = document.querySelector('.detail-location');
        if (detailLoc) detailLoc.innerHTML = `ðŸ“ ${p.location?.locality || ''}, ${p.location?.city || ''}, ${p.location?.state || ''}`;

        // ---- Specs ----
        const specsEl = document.querySelector('.detail-specs');
        if (specsEl) {
          const specs = [];
          if (!isLand && !isCommercial && bhk && bhk !== '0') {
            specs.push({ icon: 'ðŸ›ï¸', val: `${bhk} BHK`, label: 'Bedrooms' });
          }
          if (area > 0) specs.push({ icon: 'ðŸ“', val: `${area.toLocaleString('en-IN')} sq.ft`, label: 'Built-up Area' });
          if (p.details?.carpetArea) specs.push({ icon: 'ðŸ“', val: `${p.details.carpetArea} sq.ft`, label: 'Carpet Area' });
          if (p.details?.facing) specs.push({ icon: 'ðŸ§­', val: p.details.facing, label: 'Facing' });
          if (!isLand && p.details?.floorNumber) {
            specs.push({ icon: 'ðŸ¢', val: `${p.details.floorNumber}${p.details.totalFloors ? ' / ' + p.details.totalFloors : ''}`, label: 'Floor' });
          }
          if (!isLand && p.details?.furnishing) specs.push({ icon: 'ðŸ›‹ï¸', val: p.details.furnishing, label: 'Furnishing' });
          if (p.details?.parking && p.details.parking !== 'None') specs.push({ icon: 'ðŸš—', val: p.details.parking, label: 'Parking' });
          if (p.details?.constructionYear) specs.push({ icon: 'ðŸ“…', val: p.details.constructionYear, label: 'Built Year' });

          specsEl.innerHTML = specs.map(s => `
        <div class="detail-spec">
          <div class="detail-spec-icon">${s.icon}</div>
          <div class="detail-spec-value">${s.val}</div>
          <div class="detail-spec-label">${s.label}</div>
        </div>`).join('');
        }

        // ---- Description ----
        const descEl = document.getElementById('dynamicDescription');
        if (descEl && p.details?.description) {
          descEl.textContent = p.details.description;
        }

        // ---- Dynamic Property Tags (Consolidated) ----
        function buildTag(icon, text, colorClass = 'primary') {
          return `<span class="badge badge-${colorClass}" style="display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700"><i class="fa-solid ${icon}"></i> ${text}</span>`;
        }

        const topTags = document.getElementById('topTags');
        const detailTags = document.getElementById('detailTags'); // tags under description

        let commonTags = '';
        const isRent = p.transactionType?.toLowerCase().includes('rent');
        commonTags += buildTag(isRent ? 'fa-key' : 'fa-house', isRent ? 'RENT' : 'BUY', isRent ? 'warning' : 'primary');
        if (p.verified) commonTags += buildTag('fa-circle-check', 'Verified', 'verified');
        if (p.details?.status === 'Ready to Move' || p.status === 'ready') commonTags += buildTag('fa-check', 'Ready to Move', 'success');
        if (p.details?.rera) commonTags += `<span style="background:#EFF6FF;color:#3B82F6;padding:4px 10px;border-radius:6px;font-size:11px;font-weight:700"><i class="fa-solid fa-file-contract"></i> RERA: ${p.details.rera}</span>`;

        if (topTags) topTags.innerHTML = commonTags;
        if (detailTags) {
          // Add some specific tags for description area if needed
          let descTags = commonTags;
          if (p.contactDesc?.role === 'Owner') descTags += buildTag('fa-user-check', 'Owner Listing', 'info');
          detailTags.innerHTML = descTags;
        }

        // ---- Key Highlights ----
        const highlightsCard = document.getElementById('keyHighlightsCard');
        const highlightsList = document.getElementById('keyHighlightsList');
        if (highlightsCard && highlightsList) {
          let hlHtml = '';
          if (p.details?.rera) {
            hlHtml += `
            <div style="display:flex;align-items:center;gap:10px;font-size:13px">
              <span style="width:28px;height:28px;background:rgba(16,185,129,0.1);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0"><i class="fa-solid fa-check" style="color:#10b981"></i></span>
              <span style="color:var(--text)">RERA Registered Project</span>
            </div>`;
          }
          if (p.verified) {
            hlHtml += `
            <div style="display:flex;align-items:center;gap:10px;font-size:13px">
              <span style="width:28px;height:28px;background:rgba(59,130,246,0.1);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0"><i class="fa-solid fa-magnifying-glass" style="color:#3fb8f6"></i></span>
              <span style="color:var(--text)">Physically Verified Listing</span>
            </div>`;
          }
          if (p.contactDesc?.role === 'Owner') {
            hlHtml += `
            <div style="display:flex;align-items:center;gap:10px;font-size:13px">
              <span style="width:28px;height:28px;background:rgba(245,158,11,0.1);border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0"><i class="fa-solid fa-handshake" style="color:#f59e0b"></i></span>
              <span style="color:var(--text)">Zero Brokerage (Direct Owner)</span>
            </div>`;
          }
          if (hlHtml) {
            highlightsList.innerHTML = hlHtml;
            highlightsCard.style.display = 'block';
          }
        }

        // ---- Listed By (Owner Info) ----
        if (p.ownerInfo) {
          const ownerAvatar = document.getElementById('ownerAvatar');
          const ownerName = document.getElementById('ownerName');
          const ownerJoinDate = document.getElementById('ownerJoinDate');
          
          if (ownerName) ownerName.textContent = p.ownerInfo.name;
          if (ownerAvatar) {
            if (p.ownerInfo.profilePictureUrl) {
              ownerAvatar.innerHTML = `<img src="${p.ownerInfo.profilePictureUrl}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
              ownerAvatar.style.background = 'transparent';
            } else {
              ownerAvatar.innerHTML = `<img src="images/favicon.svg" style="width:100%;height:100%;border-radius:50%;object-fit:contain;background:var(--primary);padding:4px;">`;
              ownerAvatar.style.background = 'var(--primary)';
              ownerAvatar.textContent = '';
            }
          }
          if (ownerJoinDate) {
            ownerJoinDate.innerHTML = `<i class="fa-solid fa-user-tag"></i> ${p.contactDesc?.role || 'Owner'} Â· Member since ${p.ownerInfo.joinedYear || 2024}`;
          }
        }

        // ---- Amenities ----
        const amenGrid = document.querySelector('.amenities-grid');
        if (amenGrid && p.amenities?.length > 0) {
          const icons = {
            'Swimming Pool': 'ðŸŠ', 'Gym': 'ðŸ’ª', 'Clubhouse': 'ðŸ ', 'Security': 'ðŸ”’',
            'Power Backup': 'âš¡', 'Lift': 'ðŸ›—', 'Garden': 'ðŸŒ³', 'Parking': 'ðŸš—',
            'Play Area': 'ðŸŽ®', 'Fire Safety': 'ðŸ”¥', 'Intercom': 'ðŸ“¡', 'CCTV': 'ðŸ“¹',
            'WiFi': 'ðŸ“¶', 'Gas Pipeline': 'ðŸ”¥', 'Solar': 'â˜€ï¸'
          };
          amenGrid.innerHTML = p.amenities.map(a => {
            const icon = Object.entries(icons).find(([k]) => a.toLowerCase().includes(k.toLowerCase()))?.[1] || 'âœ…';
            return `<div class="amenity-item"><div class="amenity-icon">${icon}</div> ${a}</div>`;
          }).join('');
        } else if (amenGrid && (!p.amenities || p.amenities.length === 0)) {
          amenGrid.closest('.detail-card')?.remove(); // hide empty amenities section
        }

        // ---- Contact card ----
        if (p.contactDesc) {
          const ct = p.contactDesc;
          const sellerDiv = document.querySelector('.detail-card h3')?.closest('.detail-card');
          // Update seller info
          const sellerCard = document.querySelectorAll('.detail-card');
          sellerCard.forEach(card => {
            if (card.querySelector('h3')?.textContent.includes('Listed By')) {
              const nameEl = card.querySelector('div[style*="font-weight:700"]') || card.querySelector('.font-bold');
              const initial = document.querySelector('.detail-card div[style*="border-radius:50%"]');
              if (initial) initial.textContent = (ct.name || 'U')[0].toUpperCase();
              const rows = card.querySelectorAll('div[style*="font-weight:700"]');
              if (rows[0]) rows[0].textContent = ct.name || 'Owner';
              const roleEl = card.querySelector('div[style*="font-size:12px"]');
              if (roleEl) roleEl.textContent = `ðŸ  ${ct.role || 'Owner'} Â· Listed on 24Dismil.com`;
            }
          });

          // Update Call/WhatsApp buttons with real owner number from DB
          const callBtn = document.getElementById('btnCallNow');
          const waBtn = document.getElementById('btnWhatsApp');
          if (callBtn && ct.mobile) {
            callBtn.dataset.phone = ct.mobile;
            callBtn.onclick = () => window.location.href = `tel:${ct.mobile}`;
          }
          if (waBtn && ct.mobile) {
            waBtn.dataset.phone = ct.mobile;
            waBtn.onclick = () => {
              const msg = document.getElementById('contactMessage')?.value.trim() ||
                'Hi, I am interested in this property. Please contact me.';
              const name = document.getElementById('contactName')?.value.trim() || '';
              const text = encodeURIComponent((name ? 'Name: ' + name + '\n' : '') + msg);
              window.open(`https://wa.me/91${ct.mobile}?text=${text}`, '_blank');
            };
          }
        }

        // ---- Google Maps link ----
        const mapsLink = document.querySelector('a[href*="maps.google.com"]');
        if (mapsLink) {
          const addr = encodeURIComponent(`${p.location?.locality || ''} ${p.location?.city || ''} ${p.location?.state || ''} ${p.location?.pinCode || ''}`);
          mapsLink.href = `https://maps.google.com?q=${addr}`;
        }
        const mapText = document.querySelector('[href*="maps.google.com"]')?.previousElementSibling;
        if (mapText) mapText.textContent = `${p.location?.locality || ''}, ${p.location?.city || ''} ${p.location?.pinCode || ''}`;

        // ---- Populate Modal Header Details ----
        PROPERTY_ID = id;
        if (p.contactDesc) {
          REAL_OWNER_PHONE = p.contactDesc.mobile;
          REAL_OWNER_NAME = p.contactDesc.name || 'Owner';
        }

        // Format Date from property creation (if we have access to _creationTime from convex)
        const creationDate = p._creationTime ? new Date(p._creationTime).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' }) : 'Recently';
        if (advDateDisplay) advDateDisplay.textContent = `Posted On: ${creationDate}`;

        // Format Price & Address
        const shortAddress = `${p.location?.locality || ''}, ${p.location?.city || ''}`;
        let formattedPrice = 'Price on Request';
        if (price > 0) {
          if (price >= 10000000) formattedPrice = `â‚¹${(price / 10000000).toFixed(2)} Cr`;
          else if (price >= 100000) formattedPrice = `â‚¹${(price / 100000).toFixed(2)} Lac`;
          else formattedPrice = priceStr;
        }
        if (advPriceAddress) advPriceAddress.textContent = `${formattedPrice} | ${shortAddress}`;

        // Format Area & Type
        const areaStr = area > 0 ? `${area.toLocaleString('en-IN')} SQ.FT.` : '';
        const propTypeStr = p.propertyType ? p.propertyType.toUpperCase() : '';
        if (advAreaType) advAreaType.textContent = `${areaStr} | ${propTypeStr}`;

        // ---- Override Modal Submit for Real DB Submit ----
        const newAdvSubmit = advBtnSubmit.cloneNode(true);
        advBtnSubmit.parentNode.replaceChild(newAdvSubmit, advBtnSubmit);

        newAdvSubmit.addEventListener('click', async function () {
          const name = document.getElementById('advInputName').value.trim();
          const phone = document.getElementById('advInputPhone').value.trim();
          const termsChecked = document.getElementById('advCheckTerms').checked;

          // Extract Chip values
          const reason = document.getElementById('valReason')?.value || '';
          const dealer = document.getElementById('valDealer')?.value || '';
          const timeframe = document.getElementById('valTimeframe')?.value || '';
          const loan = document.getElementById('advCheckLoan').checked ? 'Yes' : 'No';
          const visit = document.getElementById('advCheckVisit').checked ? 'Yes' : 'No';

          if (!name || !phone) {
            alert('Please enter your Name and Mobile Number.');
            return;
          }
          if (!termsChecked) {
            alert('Please agree to the Terms & Conditions.');
            return;
          }

          this.disabled = true;
          this.textContent = 'Submitting...';

          // Format payload into single message string
          const fullMessage = `
--- Advertiser Modal Enquiry ---
Reason to Buy: ${reason}
Property Dealer: ${dealer}
Planning to Buy In: ${timeframe}
Interested in Home Loan: ${loan}
Interested in Site Visit: ${visit}
      `.trim();

          try {
            await convex.mutation('properties:contactOwner', {
              propertyId: PROPERTY_ID,
              name,
              phone,
              email: '', // Not collected in this modal
              message: fullMessage
            });

            // UI Success state
            this.style.display = 'none';
            document.getElementById('advSuccessMsg').style.display = 'block';

            // Reveal Owner Details!
            advHeaderPhone.textContent = '+91 ' + REAL_OWNER_PHONE;
            advHeaderName.textContent = REAL_OWNER_NAME;

            // Clear only core inputs, keep preferences
            document.getElementById('advInputName').value = '';
            document.getElementById('advInputPhone').value = '';
            document.getElementById('advCheckTerms').checked = false;

          } catch (err) {
            alert('Failed to send enquiry: ' + err.message);
            this.disabled = false;
            this.textContent = 'Get Contact Details';
          }
        });

        // Keep OLD Handle Contact Owner Form valid for DOM safety
        const btnSendEnquiry = document.getElementById('btnSendEnquiry');
        if (btnSendEnquiry) {
          // Remove fallback listener and replace with DB-backed version
          const newBtn = btnSendEnquiry.cloneNode(true);
          btnSendEnquiry.parentNode.replaceChild(newBtn, btnSendEnquiry);

          newBtn.addEventListener('click', async () => {
            const name = document.getElementById('contactName')?.value.trim();
            const phone = document.getElementById('contactPhone')?.value.trim();
            const email = document.getElementById('contactEmail')?.value.trim();
            const message = document.getElementById('contactMessage')?.value.trim();
            const successMsg = document.getElementById('contactSuccess');
            const loader = document.getElementById('contactLoader');

            if (!name || !phone) {
              alert('Name aur Mobile Number zaroori hai.');
              return;
            }

            newBtn.style.display = 'none';
            if (loader) loader.style.display = 'block';

            try {
              await convex.mutation('properties:contactOwner', {
                propertyId: id,
                name, phone, email: email || '', message: message || ''
              });
              if (loader) loader.style.display = 'none';
              if (successMsg) successMsg.style.display = 'block';

              // Clear inputs
              document.getElementById('contactName').value = '';
              document.getElementById('contactPhone').value = '';
              document.getElementById('contactEmail').value = '';
              document.getElementById('contactMessage').value = 'Hi, I am interested in this property. Please contact me.';

              setTimeout(() => {
                if (successMsg) successMsg.style.display = 'none';
                newBtn.style.display = 'inline-block';
              }, 5000);

            } catch (err) {
              alert('Enquiry bhejne mein error: ' + err.message);
              newBtn.style.display = 'inline-block';
              if (loader) loader.style.display = 'none';
            }
          });
        }

        // ---- EMI seed value ----
        const emiLoan = document.getElementById('emi-loan');
        if (emiLoan && price > 0) {
          emiLoan.value = Math.round(price * 0.8); // 80% as loan
          emiLoan.dispatchEvent(new Event('input'));
        }

        // ---- Similar Properties ----
        try {
          const allProps = await convex.query('properties:getProperties', {}) || [];
          const similar = allProps
            .filter(item => item._id !== id && item.id !== id) // Exclude current
            .filter(item => (item.location?.city === p.location?.city) || (item.propertyType === p.propertyType))
            .slice(0, 4); // Take up to 4

          const slider = document.getElementById('similarPropertiesSlider');
          if (slider && similar.length > 0) {
            let htmlStr = '';
            for (const sp of similar) {
              const spPrice = sp.pricing?.expectedPrice || 0;
              let spPriceStr = 'Price on Request';
              if (spPrice > 0) {
                if (spPrice >= 10000000) spPriceStr = `â‚¹${(spPrice / 10000000).toFixed(2)} Cr`;
                else if (spPrice >= 100000) spPriceStr = `â‚¹${(spPrice / 100000).toFixed(2)} Lac`;
                else spPriceStr = `â‚¹${spPrice.toLocaleString('en-IN')}`;
              }

              let spPhoto = 'images/property-1.webp';
              if (sp.photos && sp.photos[0]) {
                spPhoto = (typeof sp.photos[0] === 'object' ? sp.photos[0].url : sp.photos[0]) || spPhoto;
              }

              let spTitle = sp.propertyType || 'Property';
              if (!/plot|land|commercial|shop/i.test(spTitle) && sp.details?.bhk && sp.details.bhk !== '0') {
                spTitle = `${sp.details.bhk} BHK ${spTitle}`;
              }

              htmlStr += `
                  <div class="property-card" style="min-width:280px;flex-shrink:0;cursor:pointer;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff;transition:transform 0.2s" onclick="window.location.href='property-detail.html?id=${sp._id || sp.id}'" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
                    <div class="prop-img-wrap" style="position:relative"><img src="${spPhoto}" alt="${spTitle}" loading="lazy" style="height:200px;object-fit:cover;width:100%">
                      <div class="prop-type-badge" style="position:absolute;top:10px;left:10px"><span class="badge ${sp.type === 'rent' ? 'badge-warning' : 'badge-primary'}" style="background:var(--primary);color:#fff;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:700">${sp.type === 'rent' ? 'RENT' : 'BUY'}</span></div>
                      ${sp.verified ? '<div class="prop-verified" style="position:absolute;bottom:10px;left:10px;background:rgba(16,185,129,0.9);color:#fff;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600"><i class="fa-solid fa-circle-check"></i> Verified</div>' : ''}
                    </div>
                    <div class="prop-body" style="padding:16px">
                      <div class="prop-price" style="font-size:20px;font-weight:800;color:var(--primary);margin-bottom:4px">${spPriceStr}</div>
                      <div class="prop-title" style="font-size:15px;font-weight:700;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${spTitle}</div>
                      <div class="prop-location" style="color:var(--text-muted);font-size:13px;margin:8px 0"><i class="fa-solid fa-location-dot"></i> ${sp.location?.locality || ''}, ${sp.location?.city || ''}</div>
                      <div class="prop-specs" style="display:flex;gap:12px;font-size:13px;color:var(--text-muted);border-top:1px solid var(--border);padding-top:12px;margin-top:12px">
                        ${sp.details?.bhk ? `<div><i class="fa-solid fa-bed"></i> ${sp.details.bhk} BHK</div>` : ''}
                        ${sp.details?.builtUpArea ? `<div><i class="fa-solid fa-ruler-combined"></i> ${sp.details.builtUpArea} sq.ft</div>` : ''}
                      </div>
                    </div>
                  </div>
                `;
            }
            slider.innerHTML = htmlStr;
          } else if (slider) {
            slider.parentElement.parentElement.style.display = 'none';
          }
        } catch (e) {
          console.error('Failed to load similar properties', e);
          const slider = document.getElementById('similarPropertiesSlider');
          if (slider) slider.parentElement.parentElement.style.display = 'none';
        }

      } catch (err) {
        console.error('Failed to load property details:', err);
      }
    })();
  </script>
<script src="js/city-selector.js"></script>

</body>

</html>